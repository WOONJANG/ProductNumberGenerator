<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>품번 생성기 | 브랜드-년도-월-소재-품목-넘버-홈/어웨이</title>
  <style>
    body{margin:0;font-family:system-ui;background:#0b0b10;color:#eee}
    .wrap{max-width:1000px;margin:20px auto;padding:16px}
    h1{font-size:20px;margin-bottom:12px}
    .card{background:#12121a;border:1px solid #232334;border-radius:12px;padding:16px;margin-bottom:20px}
    label{font-size:12px;color:#aaa;display:block;margin-bottom:4px}
    select,input{width:100%;padding:8px;border-radius:8px;border:1px solid #2a2a44;background:#0b0b13;color:#eee}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .sku{font-family:monospace;background:#07070c;border:1px solid #202033;border-radius:8px;padding:10px 12px;font-size:18px;margin:8px 0}
    button{cursor:pointer;border:0;border-radius:8px;padding:8px 12px;background:#5566cc;color:white;font-weight:600;margin-right:8px}
    button:active{transform:translateY(1px)}
    textarea{width:100%;height:60px;padding:8px;border-radius:8px;background:#0b0b13;color:#eee;border:1px solid #2a2a44;margin-top:6px}
  </style>
  <script>
    // ====== CONFIG: Google Apps Script Web App URL (deploy 후 URL 붙여넣기) ======
    const CONFIG = { ENDPOINT: 'https://script.google.com/macros/s/AKfycbwHHKnISIdbAFw9RJue2DJd5S13vpwD80yeRx8dlP1_k7Dr6-PIEVw1j4dQxpjXFDJnBg/exec' };
  </script>
</head>
<body>
  <div class="wrap">
    <h1>품번 생성기 (브랜드-년도-월-소재-품목-넘버-홈/어웨이)</h1>
<div class="card" style="display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap">
  <div style="font-size:12px;color:#bbb">Google 스프레드시트 연동: <span id="syncStatus">대기</span></div>
  <div>
    <button id="btnRefresh" title="스프레드시트에서 불러오기">데이터 새로고침</button>
  </div>
</div>

    <div class="card grid">
      <div>
        <label>브랜드</label>
        <select id="brand"></select>
        <textarea id="brandInput" placeholder="예: J=정관장, V=브이엑스"></textarea>
        <button onclick="updateOptions('brand')">브랜드 추가/갱신</button>
      </div>
      <div>
        <label>년도</label>
        <input id="year" type="number" min="2000" max="2099" value="2025"/>
      </div>
      <div>
        <label>월</label>
        <select id="month">
          <option value="01">01</option><option value="02">02</option><option value="03">03</option>
          <option value="04">04</option><option value="05">05</option><option value="06">06</option>
          <option value="07">07</option><option value="08" selected>08</option><option value="09">09</option>
          <option value="10">10</option><option value="11">11</option><option value="12">12</option>
        </select>
      </div>
      <div>
        <label>홈/어웨이</label>
        <select id="ha"><option value="H">H — 홈</option><option value="A">A — 어웨이</option></select>
      </div>
    </div>

    <div class="card grid">
      <div>
        <label>소재</label>
        <select id="material"></select>
        <textarea id="materialInput" placeholder="예: P=폴리, C=면"></textarea>
        <button onclick="updateOptions('material')">소재 추가/갱신</button>
      </div>
      <div>
        <label>품목</label>
        <select id="item"></select>
        <textarea id="itemInput" placeholder="예: 18=유니폼, 01=패딩"></textarea>
        <button onclick="updateOptions('item')">품목 추가/갱신</button>
      </div>
      <div>
        <label>넘버</label>
        <select id="number"></select>
        <textarea id="numberInput" placeholder="예: 1=어센틱, 2=레플리카"></textarea>
        <button onclick="updateOptions('number')">넘버 추가/갱신</button>
      </div>
    </div>

    <div class="card">
      <label>생성된 품번</label>
      <div id="sku" class="sku">-</div>
      <button onclick="copySku()">복사</button>
    </div>
  </div>

  <script>
    const YEAR_CODE={0:'J',1:'A',2:'B',3:'C',4:'D',5:'E',6:'F',7:'G',8:'H',9:'I'};

    const defaultData={
      brand:{'J':'정관장','V':'브이엑스','L':'라이온즈','A':'안양','N':'엔씨','NX':'네임엑스'},
      material:{'P':'폴리','C':'면','N':'나일론','W':'우븐'},
      item:{'18':'유니폼','01':'패딩','02':'조끼패딩'},
      number:{'1':'어센틱','2':'레플리카'}
    };

    async function fetchFromSheet(){
      const status=document.getElementById('syncStatus');
      if(!CONFIG.ENDPOINT){ status.textContent='엔드포인트 미설정'; return null; }
      status.textContent='불러오는 중…';
      try{
        const res = await fetch(CONFIG.ENDPOINT,{method:'GET',headers:{'accept':'application/json'}});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();
        // 예상 형태: { brand:{code:name,...}, material:{...}, item:{...}, number:{...} }
        ['brand','material','item','number'].forEach(k=>{
          if(data && data[k] && typeof data[k]==='object'){
            defaultData[k] = data[k];
          }
        });
        status.textContent='동기화 완료';
        loadOptions();
      }catch(err){
        console.error(err);
        status.textContent='동기화 실패 (기본 데이터 사용)';
      }
    }

    function loadOptions(){
      for(let key in defaultData){
        const sel=document.getElementById(key);
        sel.innerHTML="";
        for(let c in defaultData[key]){
          const opt=document.createElement('option');
          opt.value=c; opt.textContent=c+" — "+defaultData[key][c];
          sel.appendChild(opt);
        }
      }
      buildSKU();
    }

    function updateOptions(type){
      const input=document.getElementById(type+"Input").value.trim();
      if(!input) return;
      const lines=input.split(/\n|,/);
      lines.forEach(line=>{
        const [code,name]=line.split('=');
        if(code&&name){
          defaultData[type][code.trim()]=name.trim();
        }
      });
      loadOptions();
    }

    function toYearCode(y){
      const last=Number(String(y).slice(-1));
      return YEAR_CODE[last];
    }

    function buildSKU(){
      const b=document.getElementById('brand').value;
      const y=Number(document.getElementById('year').value||0);
      const yC=toYearCode(y);
      const m=document.getElementById('month').value;
      const mat=document.getElementById('material').value;
      const it=document.getElementById('item').value;
      const num=document.getElementById('number').value;
      const ha=document.getElementById('ha').value;
      const sku=b+yC+m+mat+it+num+ha;
      document.getElementById('sku').textContent=sku;
    }

    function copySku(){
      navigator.clipboard.writeText(document.getElementById('sku').textContent);
      alert('복사됨');
    }

    ['brand','year','month','material','item','number','ha'].forEach(id=>{
      document.getElementById(id).addEventListener('input',buildSKU);
    });

    loadOptions();
    // 초기 로드 시 시트 동기화
    fetchFromSheet();
    document.getElementById('btnRefresh').addEventListener('click',fetchFromSheet);
  </script>
</body>
</html>
